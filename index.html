<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Project</title>
    <style>
      /* --- Basic Setup --- */
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        color: #333;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        margin: 0;
        padding: 20px 0;
      }

      /* --- Main App Container --- */
      .app-container {
        width: 90%;
        max-width: 300px;
        background-color: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        text-align: center;
        padding: 20px;
      }
      
      .app-container h1 {
          margin-top: 0;
          margin-bottom: 5px;
      }
      
      .progress-counter {
          color: #888;
          font-weight: bold;
          margin-top: 0;
          margin-bottom: 15px;
          min-height: 1.2em; /* Reserve space to prevent layout shift */
      }

      /* --- Image/Summary Area --- */
      .cat-images-container {
        aspect-ratio: 1 / 1;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1) inset;
        margin: 0 auto 20px auto;
        position: relative;
        overflow: hidden;
        background-color: #e9e9e9;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column; /* For summary layout */
        padding: 15px;
        box-sizing: border-box; /* Ensures padding is included in size */
      }

      .cat-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 12px;
        cursor: grab;
        position: absolute;
        left: 0;
        top: 0;
        user-select: none;
        opacity: 1;
        transition: opacity 0.3s ease;
      }
      
      .cat-image.loading {
          opacity: 0;
      }
      
      /* --- Summary View (inside container) --- */
       .summary-title {
          margin-top: 0;
          margin-bottom: 10px;
       }
      .thumbnail-list {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
          justify-content: center;
          margin-bottom: 15px;
      }
      .thumbnail {
          width: 60px;
          height: 60px;
          border-radius: 8px;
          object-fit: cover;
          box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }
      .summary-text {
          margin-top: 0px;
          margin-bottom: 5px;
          font-size: 0.9em;
          color: #555;

      }
       .restart-button {
            background-color: #007aff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .restart-button:hover {
            background-color: #0056b3;
        }

      /* --- Animations --- */
      .swipe-left {
        animation: swipeLeft 0.65s forwards;
      }
      .swipe-right {
        animation: swipeRight 0.65s forwards;
      }

      @keyframes swipeLeft {
        from { transform: translateX(0) rotate(0deg); opacity: 1; }
        to   { transform: translateX(-150%) rotate(-20deg); opacity: 0; }
      }

      @keyframes swipeRight {
        from { transform: translateX(0) rotate(0deg); opacity: 1; }
        to   { transform: translateX(150%) rotate(20deg); opacity: 0; }
      }
      
      .hidden {
          display: none;
      }
    </style>
</head>
<body>
    <div class="app-container">
        <h1>Cat Project</h1>
        <p class="progress-counter"></p>
        <div class="cat-images-container">
            <!-- Content is generated by JavaScript -->
        </div>
        <p class="swipe-instructions">Swipe Left &#128148; &nbsp; Swipe Right &#128150;</p>
    </div>

    <script>
        // --- Get references to our HTML elements ---
        const imageContainer = document.querySelector('.cat-images-container');
        const progressCounter = document.querySelector('.progress-counter');
        const swipeInstructions = document.querySelector('.swipe-instructions');

        // --- Variables to keep track of our app's data ---
        let catDeck = [];       // Our list of cat picture URLs
        let likedCats = [];     // A list for liked cat pictures
        let dislikedCats = [];  // A list for disliked cat pictures
        let currentIndex = 0;   // The number of the cat we are currently on
        let catImageElement = null; // A variable to hold the current <img> tag

        let startX = 0;
        let isDragging = false;
        let isAnimating = false;

        // --- Main Functions ---

        // This function runs first. It gets the cat pictures from the internet.
        async function getCatImages() {
            imageContainer.innerHTML = '<p>Loading...</p>';
            progressCounter.textContent = '';
            swipeInstructions.classList.remove('hidden');

            const CAT_API_URL = 'https://api.thecatapi.com/v1/images/search?limit=10';

            try {
                const response = await fetch(CAT_API_URL);
                const catDataList = await response.json(); 
                
                catDeck = catDataList.map(catData => catData.url);
                
                initializeApp();

            } catch (error) {
                imageContainer.innerHTML = '<p>Error loading cats. Please refresh.</p>';
                console.error("Failed to fetch cat images:", error);
            }
        }

        function preloadNextImage() {
            if (currentIndex + 1 < catDeck.length) {
                const nextImageUrl = catDeck[currentIndex + 1];

                const preloadImg = new Image();
                preloadImg.src = nextImageUrl;
            }
        }

        // This function sets up the app for a new round.
        function initializeApp() {
            likedCats = [];
            dislikedCats = [];
            currentIndex = 0;
            isAnimating = false;
            
            if (catDeck.length > 0) {
                updateProgressCounter();
                showNextCat();
            } else {
                imageContainer.innerHTML = '<p>No cats found.</p>';
            }
        }

        // This function shows the next cat from our deck.
        function showNextCat() {
            if (currentIndex >= catDeck.length) {
                displaySummary();
                return;
            }

            const newImage = document.createElement('img');
            newImage.src = catDeck[currentIndex];
            newImage.className = 'cat-image loading';
            
            newImage.onload = () => {
                imageContainer.innerHTML = '';
                imageContainer.appendChild(newImage);
                
                setTimeout(() => newImage.classList.remove('loading'), 50);

                catImageElement = newImage;
                addEventListenersToImage(catImageElement);
                isAnimating = false;

                preloadNextImage()
            };

            newImage.onerror = () => {
                console.error("Image failed to load, skipping:", newImage.src);
                currentIndex++;
                showNextCat();
            };
        }

        // This function handles what happens after a swipe.
        function processSwipe(direction) {
            if (!catImageElement) return;

            isAnimating = true;
            const catUrl = catDeck[currentIndex];

            if (direction === 'right') {
                catImageElement.classList.add('swipe-right');
                likedCats.push(catUrl);
            } else {
                catImageElement.classList.add('swipe-left');
                dislikedCats.push(catUrl);
            }
            
            currentIndex++;
            updateProgressCounter();

            // After the swipe animation finishes, show the next cat.
            catImageElement.addEventListener('animationend', showNextCat, { once: true });
        }
        
        // This function shows the final summary screen.
        function displaySummary() {
            imageContainer.innerHTML = '';
            swipeInstructions.classList.add('hidden');
            
            const title = document.createElement('h3');
            title.className = 'summary-title';
  

            const summaryText = document.createElement('p');
            summaryText.className = 'summary-text';
            summaryText.textContent = `You liked ${likedCats.length} out of ${catDeck.length} cats.`;
            
            const thumbnailList = document.createElement('div');
            thumbnailList.className = 'thumbnail-list';
            
            if (likedCats.length > 0) {
                likedCats.forEach(url => {
                    const thumb = document.createElement('img');
                    thumb.src = url;
                    thumb.className = 'thumbnail';
                    thumbnailList.appendChild(thumb);
                });
            } else {
                thumbnailList.textContent = "You didn't like any cats this round!";
            }
            
            const restartButton = document.createElement('button');
            restartButton.className = 'restart-button';
            restartButton.textContent = 'Start Over';
            restartButton.onclick = getCatImages; // When clicked, fetch new cats.
            
            imageContainer.appendChild(title);
            imageContainer.appendChild(thumbnailList);
            imageContainer.appendChild(summaryText);
            imageContainer.appendChild(restartButton);
        }

        // A small helper function to update the "0 / 10" text.
        function updateProgressCounter() {
            progressCounter.textContent = `${currentIndex} / ${catDeck.length}`;
        }
        
        // --- Functions that handle the mouse/touch dragging ---
        
        // This function adds the swipe listeners to our cat image.
        function addEventListenersToImage(element) {
            element.addEventListener('dragstart', (e) => e.preventDefault());
            element.addEventListener('mousedown', handleDragStart);
            element.addEventListener('touchstart', handleDragStart, { passive: false });
        }

        // This runs when you first press down on the image.
        const handleDragStart = (e) => {
            if (isAnimating) return;
            isDragging = true;
            startX = e.pageX || e.touches[0].pageX;
            if (catImageElement) catImageElement.style.cursor = 'grabbing';
            e.preventDefault();
        };

        // This runs when you lift your finger/mouse.
        const handleDragEnd = (e) => {
            if (!isDragging || isAnimating) return;
            isDragging = false;
            
            const endX = e.pageX || e.changedTouches[0].pageX;
            const diffX = endX - startX;
            
            if (catImageElement) catImageElement.style.cursor = 'grab';

            // If the swipe was long enough, process it.
            if (Math.abs(diffX) > 50) {
                processSwipe(diffX > 0 ? 'right' : 'left');
            }
        };

        // Listen for the drag to end anywhere on the page.
        document.addEventListener('mouseup', handleDragEnd);
        document.addEventListener('touchend', handleDragEnd);

        // --- Start the app! ---
        getCatImages();

    </script>
</body>
</html>
